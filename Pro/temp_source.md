2 100
34
100 10
200 0 1 1 1 3
200 0 2 3 1 3
200 0 3 6 6 4
300 1 3 3 2 1
200 3 4 1 1 4
300 4 3 2 4 3
200 6 5 1 6 4
200 7 6 1 0 3
200 8 7 6 4 3
300 9 5 2 5 3 7 6
200 10 8 1 2 4
200 10 9 4 2 3
200 10 10 1 6 4
200 10 11 3 3 3
300 10 5 2 10 8 5 3
200 11 12 2 7 3
300 11 5 10 8 5 3 12
300 12 5 10 5 3 12 7
200 14 13 3 2 3
200 14 14 2 1 3
200 14 15 1 0 3
300 15 4 5 15 14 13
200 18 16 6 2 3
200 21 17 4 2 4
200 22 18 0 6 4
200 22 19 3 1 4
300 23 5 13 19 18 17 16
200 24 20 1 1 4
200 26 21 7 7 3
200 26 22 5 1 5
300 27 5 13 22 17 20 21
200 32 23 6 6 4
300 33 4 13 22 23 20
66
100 30
200 1 668 21 4 6
200 2 134 17 6 4
200 2 442 21 19 5
200 4 855 2 25 5
200 6 847 13 4 10
300 8 5 847 668 855 442 134
200 9 499 13 11 15
300 12 5 499 847 668 855 442
200 12 355 8 14 12
200 13 451 14 17 13
200 14 184 11 8 11
200 17 579 6 22 6
200 20 956 7 4 3
200 25 908 11 6 15
200 27 533 4 7 14
200 28 883 1 18 12
200 29 169 3 7 15
200 32 659 17 17 12
200 36 319 13 9 4
300 39 5 908 451 659 579 855
200 39 961 16 11 10
300 40 5 908 451 659 961 579
200 45 229 6 9 13
300 47 5 451 961 229 659 579
200 48 757 8 13 5
200 50 607 13 6 7
200 53 615 20 24 3
200 59 975 4 1 5
200 60 224 9 19 7
200 60 356 3 11 5
200 63 45 17 9 8
200 63 331 17 23 5
200 66 683 16 24 6
200 69 636 26 17 3
300 70 5 961 757 45 224 956
300 74 5 757 956 45 224 442
200 76 54 5 23 3
200 82 461 0 16 7
300 86 5 45 956 461 224 442
300 93 5 45 956 461 224 442
200 93 494 5 4 11
200 94 220 13 0 14
300 95 5 45 220 494 956 461
300 98 5 45 494 220 461 224
200 105 669 19 1 6
200 108 242 0 3 11
200 109 955 11 4 10
200 110 684 18 2 7
200 112 625 16 0 14
300 114 5 625 242 684 224 669
200 117 825 16 13 12
200 120 540 10 12 7
200 121 701 12 18 8
200 124 425 0 22 7
300 125 5 242 625 669 825 701
300 128 5 242 625 825 669 701
300 130 5 242 825 625 701 425
300 133 5 242 625 701 425 224
300 136 5 242 625 425 701 224
300 138 5 625 701 224 442 636
300 141 5 625 701 224 442 636
300 142 5 625 701 224 442 636
300 144 4 625 701 442 636
300 146 4 625 701 442 636
300 147 4 625 701 442 636

┌────────────────────────────────────────────────────┐
│ 시작: curTime → curTime+1                          │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [1] 살아있는 지렁이만 사전계산                     │
│   - nextDir[i]  = (직선? 시계90° : 유지)            │
│   - newHead[i]  = head + d(nextDir[i])             │
│   - willGrow[i] = (grow>0 ? true:false)            │
│   - tailPop[i]  = (willGrow? 없음 : 현재 tail칸)    │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [2] 머리-머리 충돌 판정                            │
│   - map<cell, list<worm>> 로 newHead를 모음         │
│   - 같은 cell로 ≥2마리 진입 → 해당 마리들 dead=1    │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [3] 경계 밖 판정                                   │
│   - newHead가 격자 밖이면 dead=1                  │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [4] 머리-몸체 충돌 판정                            │
│   - owner[newHead] = B인 경우:                      │
│       * 예외: newHead == tailPop[B] && !willGrow[B] │
│         → 충돌 아님(꼬리가 이번 초에 빠짐)         │
│       * 그 외: A는 dead=1, hitTo[A]=B              │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [5] 성장잠재력 부여(동시 적용을 위해 누적만)       │
│   - A가 B에 부딪혔고 B가 이번 턴 생존(dead=0)이면   │
│     addGrow[B] += length[A]                         │
│   - 연쇄충돌 시 전이 금지: B가 소멸이면 C에게 안 감 │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [6] 격자 증분 갱신(살아있는 지렁이만)              │
│   (1) willGrow=0 이면 owner[tailPop] = -1          │
│   (2) owner[newHead] = i                           │
│   (3) 지렁이 내부 상태 applyMove(willGrow)         │
│       - head run +=1, head좌표 이동                 │
│       - willGrow? length++, grow-- :               │
│         아니면 tail run -=1, tail좌표 이동         │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [7] 소멸 처리                                      │
│   - dead=1인 지렁이는 owner[][]에서 모두 제거       │
│   - alive=false                                     │
└───────────────┬────────────────────────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────┐
│ [8] 성장잠재력 확정(다음 턴부터 성장 반영)          │
│   - alive 지렁이에 grow += addGrow[i]               │
└────────────────────────────────────────────────────┘
